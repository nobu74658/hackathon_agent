#!/usr/bin/env python3
"""
1on1åˆ¤å®šã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
ææ¡ˆè³‡æ–™ã®ä¾‹ã§1on1åˆ¤å®šãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ã‚’ç¢ºèª
"""

import sys
from pathlib import Path

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’Pythonãƒ‘ã‚¹ã«è¿½åŠ 
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))

from app.services.dialogue_manager import DialogueManager


def test_one_on_one_detection():
    """1on1åˆ¤å®šã®ãƒ†ã‚¹ãƒˆ"""
    
    print("ğŸ¯ 1on1åˆ¤å®šãƒ†ã‚¹ãƒˆ - ææ¡ˆè³‡æ–™ã®ä¾‹")
    print("=" * 60)
    
    dialogue_manager = DialogueManager()
    
    # ææ¡ˆè³‡æ–™ã®1on1å†…å®¹
    one_on_one_content = """
**ä½è—¤**ï¼š
ç”°ä¸­ãã‚“ã€å…ˆé€±å‡ºã—ã¦ãã‚ŒãŸææ¡ˆè³‡æ–™ã€ç¢ºèªã—ãŸã‚ˆã€‚
**ç”°ä¸­**ï¼š
ã¯ã„ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ä½•ã‹æ°—ã«ãªã‚‹ç‚¹ã¯ã‚ã‚Šã¾ã—ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ
**ä½è—¤**ï¼š
ã†ãƒ¼ã‚“ã€å…¨ä½“çš„ã«ã¯æ‚ªããªã„ã‚“ã ã‘ã©ã€ã‚‚ã†å°‘ã—"ä¼ã‚ã‚‹è³‡æ–™"ã«ã—ã¦ã„ã‘ã‚‹ã¨ã„ã„ã‹ãªã€‚
**ç”°ä¸­**ï¼š
ä¼ã‚ã‚‹â€¦ã¨ã„ã†ã®ã¯ã€å†…å®¹ãŒåˆ†ã‹ã‚Šã«ãã‹ã£ãŸã¨ã„ã†ã“ã¨ã§ã—ã‚‡ã†ã‹ï¼Ÿ
**ä½è—¤**ï¼š
ãã†ã„ã†ã‚ã‘ã§ã‚‚ãªã„ã‚“ã ã‘ã©ã€ãªã‚“ã¦ã„ã†ã‹"ã‚‚ã†ä¸€æ­©"ãªã‚“ã ã‚ˆã­ã€‚ãŠå®¢ã•ã‚“ãŒã€Œãªã‚‹ã»ã©ã€ã“ã‚Œãªã‚‰ä»»ã›ãŸã„ã€ã¨æ€ãˆã‚‹ã‚ˆã†ãªä»•ä¸ŠãŒã‚Šã£ã¦ã„ã†ã®ã‹ãªã€‚
**ç”°ä¸­**ï¼š
ï¼ˆã†ãƒ¼ã‚“â€¦æ›–æ˜§ã ãªï¼‰
ãŸã¨ãˆã°ã€ã©ã“ã‚’ã©ã†å¤‰ãˆã‚‹ã¨è‰¯ããªã‚‹ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ
**ä½è—¤**ï¼š
ãã†ã ãªã‚ã€ä¾‹ãˆã°æ§‹æˆã¨ã‹ã€ãƒ‡ã‚¶ã‚¤ãƒ³ã¨ã‹ã€è¨€è‘‰ã®é¸ã³æ–¹ã¨ã‹â€¦å…¨ä½“çš„ã«ã‚‚ã£ã¨æ´—ç·´ã•ã‚Œã‚‹ã¨è‰¯ã„ã‚ˆã­ã€‚
**ç”°ä¸­**ï¼š
ã¯ã„â€¦ã€‚ãã‚Œã¯ã€ã‚¹ãƒ©ã‚¤ãƒ‰ã®è¦‹ã›æ–¹ã‚’å¤‰ãˆã‚‹ã€ã¨ã„ã†ã“ã¨ã§ã™ã‹ï¼Ÿ
**ä½è—¤**ï¼š
ã†ãƒ¼ã‚“ã€è¦‹ã›æ–¹ã‚‚ãã†ã ã‘ã©ã€ã‚„ã£ã±ã‚Š"ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ€§"ãŒå¤§äº‹ãªã‚“ã ã‚ˆã­ã€‚ãŠå®¢æ§˜ã®èª²é¡Œã‹ã‚‰å§‹ã¾ã£ã¦ã€ãã“ã«ã©ã†è²¢çŒ®ã§ãã‚‹ã®ã‹ã£ã¦æµã‚ŒãŒè‡ªç„¶ã ã¨ã€éŸ¿ãã‚“ã ã‚ˆã€‚
**ç”°ä¸­**ï¼š
ãªã‚‹ã»ã©ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ€§ã§ã™ã­ã€‚ãŸã¨ãˆã°ä½•ã‹å‚è€ƒã«ãªã‚‹è³‡æ–™ã¨ã‹ã‚ã‚Šã¾ã™ã‹ï¼Ÿ
**ä½è—¤**ï¼š
ç‰¹ã«ã“ã‚Œã£ã¦ã®ã¯ãªã„ã‘ã©ã€ä»–ã®ãƒ¡ãƒ³ãƒãƒ¼ã®è³‡æ–™ã¨ã‹è¦‹ã¦ã¿ã‚‹ã¨ã„ã„ã‹ã‚‚ã­ã€‚ç©ºæ°—æ„ŸãŒã¤ã‹ã‚ã‚‹ã¨æ€ã†ã‹ã‚‰ã€‚
**ç”°ä¸­**ï¼š
ï¼ˆç©ºæ°—æ„Ÿâ€¦ã£ã¦ä½•ã ã‚ã†ï¼‰
åˆ†ã‹ã‚Šã¾ã—ãŸã€‚ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚
**ä½è—¤**ï¼š
ã†ã‚“ã†ã‚“ã€‚ã‚ã¨ã€è³‡æ–™ã£ã¦"ã‚»ãƒ³ã‚¹"ã‚‚ã‚ã‚‹ã‹ã‚‰ã•ã€æ•°ã“ãªã—ã¦æ„Ÿè¦šã‚’ç£¨ã„ã¦ã„ã“ã†ã€‚
**ç”°ä¸­**ï¼š
ï¼ˆâ€¦çµå±€ä½•ã‚’ç›´ã›ã°ã‚ˆã‹ã£ãŸã‚“ã â€¦ï¼‰
ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚é ‘å¼µã‚Šã¾ã™ã€‚
"""
    
    print("ã€1on1åˆ¤å®šã®è©³ç´°åˆ†æã€‘")
    print("-" * 40)
    
    # 1on1åˆ¤å®šã‚’å®Ÿè¡Œ
    is_one_on_one = dialogue_manager._is_one_on_one_content(one_on_one_content)
    print(f"ğŸ¯ 1on1åˆ¤å®šçµæœ: {is_one_on_one}")
    
    # åˆ¤å®šæŒ‡æ¨™ã®è©³ç´°ç¢ºèª
    print("\nã€åˆ¤å®šæŒ‡æ¨™ã®è©³ç´°ã€‘")
    indicators = [
        ("å¯¾è©±å½¢å¼ï¼ˆï¼šãŒ2å€‹ä»¥ä¸Šï¼‰", "ï¼š" in one_on_one_content and one_on_one_content.count("ï¼š") >= 2),
        ("è·é›¢ã‚’è©°ã‚ã‚‹", "è·é›¢ã‚’è©°ã‚ã‚‹" in one_on_one_content),
        ("ä¿¡é ¼é–¢ä¿‚", "ä¿¡é ¼é–¢ä¿‚" in one_on_one_content), 
        ("æ¸©åº¦æ„Ÿ", "æ¸©åº¦æ„Ÿ" in one_on_one_content),
        ("èª²é¡Œã«å¯„ã‚Šæ·»ã£ãŸ", "èª²é¡Œã«å¯„ã‚Šæ·»ã£ãŸ" in one_on_one_content),
        ("ã‚‚ã†å°‘ã—ã€œã¨ã„ã„ã­", "ã‚‚ã†å°‘ã—" in one_on_one_content and "ã¨ã„ã„ã­" in one_on_one_content),
        ("ãŒã‚«ã‚®ã ã¨æ€ã†", "ãŒã‚«ã‚®ã ã¨æ€ã†" in one_on_one_content),
        ("ã‚’æ„è­˜ã—ã¦", "ã‚’æ„è­˜ã—ã¦" in one_on_one_content),
        ("å–¶æ¥­æ´»å‹•", "å–¶æ¥­æ´»å‹•" in one_on_one_content and "èª¿å­" in one_on_one_content),
        ("æ–°è¦ã‚¢ãƒ", "æ–°è¦ã‚¢ãƒ" in one_on_one_content),
        ("æˆç´„", "æˆç´„" in one_on_one_content),
        ("é•·æ–‡ï¼ˆ100æ–‡å­—ä»¥ä¸Šï¼‰", len(one_on_one_content) > 100)
    ]
    
    matching_count = 0
    for name, result in indicators:
        status = "âœ…" if result else "âŒ"
        print(f"  {status} {name}: {result}")
        if result:
            matching_count += 1
    
    print(f"\nğŸ“Š åˆè‡´æŒ‡æ¨™æ•°: {matching_count}/12")
    print(f"ğŸ“Š åˆ¤å®šé–¾å€¤: 3ä»¥ä¸Šã§1on1ã¨åˆ¤å®š")
    print(f"ğŸ“Š çµæœ: {'1on1ã¨åˆ¤å®š' if matching_count >= 3 else '1on1ã§ã¯ãªã„ã¨åˆ¤å®š'}")
    
    # ææ¡ˆè³‡æ–™ç‰¹æœ‰ã®è¦ç´ ã‚’ç¢ºèª
    print("\nã€ææ¡ˆè³‡æ–™é–¢é€£ã®è¦ç´ ã€‘")
    proposal_indicators = [
        ("ææ¡ˆè³‡æ–™", "ææ¡ˆè³‡æ–™" in one_on_one_content),
        ("ä¼ã‚ã‚‹è³‡æ–™", "ä¼ã‚ã‚‹è³‡æ–™" in one_on_one_content),
        ("ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ€§", "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ€§" in one_on_one_content),
        ("ç©ºæ°—æ„Ÿ", "ç©ºæ°—æ„Ÿ" in one_on_one_content),
        ("ã‚»ãƒ³ã‚¹", "ã‚»ãƒ³ã‚¹" in one_on_one_content),
        ("æ´—ç·´", "æ´—ç·´" in one_on_one_content),
        ("æ§‹æˆ", "æ§‹æˆ" in one_on_one_content),
        ("ãƒ‡ã‚¶ã‚¤ãƒ³", "ãƒ‡ã‚¶ã‚¤ãƒ³" in one_on_one_content)
    ]
    
    proposal_matching = 0
    for name, result in proposal_indicators:
        status = "âœ…" if result else "âŒ"
        print(f"  {status} {name}: {result}")
        if result:
            proposal_matching += 1
    
    print(f"\nğŸ“Š ææ¡ˆè³‡æ–™é–¢é€£è¦ç´ : {proposal_matching}/8")
    
    # æ”¹å–„ææ¡ˆ
    print("\nã€1on1åˆ¤å®šã®æ”¹å–„ææ¡ˆã€‘")
    if not is_one_on_one:
        print("âŒ ç¾åœ¨ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã§ã¯1on1ã¨èªè­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“")
        print("ğŸ’¡ æ”¹å–„æ¡ˆ:")
        print("  1. ææ¡ˆè³‡æ–™é–¢é€£ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’åˆ¤å®šæŒ‡æ¨™ã«è¿½åŠ ")
        print("  2. ä¸Šå¸ãƒ»éƒ¨ä¸‹ã®å¯¾è©±ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ ")
        print("  3. ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é–¢é€£ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ")
        
        # ææ¡ˆã™ã‚‹æ–°ã—ã„åˆ¤å®šæŒ‡æ¨™
        additional_indicators = [
            "ææ¡ˆè³‡æ–™" in one_on_one_content,
            "ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯" in one_on_one_content or "ç¢ºèªã—ãŸã‚ˆ" in one_on_one_content,
            "ã‚‚ã†å°‘ã—" in one_on_one_content,
            "ã¨ã„ã„ã‹ãª" in one_on_one_content or "ã¨ã„ã„ã­" in one_on_one_content,
            "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ€§" in one_on_one_content,
            "ã‚»ãƒ³ã‚¹" in one_on_one_content,
            "æ„Ÿè¦š" in one_on_one_content,
            "æ•°ã“ãªã—ã¦" in one_on_one_content
        ]
        
        additional_matching = sum(1 for indicator in additional_indicators if indicator)
        total_matching = matching_count + additional_matching
        
        print(f"  ğŸ“Š è¿½åŠ æŒ‡æ¨™ã‚’å«ã‚ãŸå ´åˆ: {total_matching}/20")
        print(f"  ğŸ“Š 1on1åˆ¤å®š: {'å¯èƒ½' if total_matching >= 3 else 'ä¸å¯èƒ½'}")
    else:
        print("âœ… æ­£ã—ã1on1ã¨åˆ¤å®šã•ã‚Œã¦ã„ã¾ã™")

if __name__ == "__main__":
    test_one_on_one_detection()